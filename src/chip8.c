#include "chip8.h"
#include <string.h>
#include <stdio.h>

void chip8_init(Chip8* chip){

	memset(chip,0,sizeof(Chip8));   // setting 0's at chip pointer
	chip->pc = 0x200; // program starts at adress 0x200 
        
	// only left hex bit used, right one stays 0
	static uint8_t fontset[80] = {
        	0xF0, 0x90, 0x90, 0x90, 0xF0, // 0
        	0x20, 0x60, 0x20, 0x20, 0x70, // 1
       		0xF0, 0x10, 0xF0, 0x80, 0xF0, // 2
        	0xF0, 0x10, 0xF0, 0x10, 0xF0, // 3
        	0x90, 0x90, 0xF0, 0x10, 0x10, // 4
        	0xF0, 0x80, 0xF0, 0x10, 0xF0, // 5
        	0xF0, 0x80, 0xF0, 0x90, 0xF0, // 6
        	0xF0, 0x10, 0x20, 0x40, 0x40, // 7
        	0xF0, 0x90, 0xF0, 0x90, 0xF0, // 8
        	0xF0, 0x90, 0xF0, 0x10, 0xF0, // 9
        	0xF0, 0x90, 0xF0, 0x90, 0x90, // A
        	0xE0, 0x90, 0xE0, 0x90, 0xE0, // B
        	0xF0, 0x80, 0x80, 0x80, 0xF0, // C
        	0xE0, 0x90, 0x90, 0x90, 0xE0, // D
        	0xF0, 0x80, 0xF0, 0x80, 0xF0, // E
        	0xF0, 0x80, 0xF0, 0x80, 0x80  // F
        };

	// storing font from 8th byte till 160th byte
	// first 0x4F are unused yet.
	memcpy(&chip->memory[0x50], fontset, sizeof(fontset));	
    
}


void chip8_load_rom(Chip8* chip, const char* filename){

	FILE *f = fopen(filename, "rb");
	if(!f){
		perror("failed to open ROM");
		return;
	}
	
	fread(&chip->memory[0x200],1,3584,f); 
	fclose(f);

}









